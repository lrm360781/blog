---
title: 配置NAT模式，搭建局域网
date: 2019-07-11 23:02:46
tags:
    - vm
---
## 原理
各台设备连接同一交换机，才能通处于一个网段，进而相互通信。因此局域网相互通信的条件是：
1. 各个主机的网卡连接到同一个交换机
2. 各个网卡的IP地址设置为同一个网段

## 搭建局域网
### 设置本地网络
安装VMware，设置网络模式为NAT模式。
在本地网络连接中会出现VMnet8，路径如下图所示
![](/img_vm/vm-1.png)

打开cmd，执行ipconfig
![](/img_vm/vm-2.png)
IPv4地址为 192.168.86.1  不同的电脑，后两位会不一样。
![](/img_vm/vm-3.png)
这个ip就是本地主机在以后新建出来的虚拟机与本地主机事件的局域网里的ip地址
### 虚拟机设置
打开VMware,  编辑->虚拟网络编辑器
![](/img_vm/vm-4.png)
点击更改设置，之后选择VMent8，将左下角的子网IP改成和上文中的IP处于同一网段的IP。
上文为192.168.86.1 ，则将最后一位改为0，192.168.86.0
DHCP设置里设置分配给虚拟机的开始和结束ip
![](/img_vm/vm-5.png)
点击NAT设置，设置网关
![](/img_vm/vm-9.png)
开启虚拟机，执行ifconfig，获取ip地址，备用。
### Windows添加入站规则
按下图步骤，添加你要开放的端口。
![](/img_vm/vm-6.png) 

### 添加端口转发
这是为了可以让局域网里的其他设备访问的到虚拟机
编辑>虚拟网络编辑器>vmnet8>nat设置>端口转发 添加

![](/img_vm/vm-8.png)
主机端口填的是你希望在宿主机访问哪个端口就可以访问到虚拟机

这里是8080 我在宿主机输入 localhost:8080 或者http://IP地址:8080/都可以访问到虚拟机

虚拟机ip地址和端口就是上上一步看的那个

这样就可以在宿主机器访问虚拟机服务器了

在宿主机器里输入虚拟机的ip地址也可以访问。
### 本地主机配置
现在本地主机可以访问虚拟机服务器了，但局域网里其他设备还不可以。
打开下图所在路径，共享网络。

![](/img_vm/vm-7.png)

完成之后，局域网内的其他电脑可以访问到虚拟机。
通过，本地主机ip:8080访问，前提是你开启了虚拟机的相应服务，并且设置好了防火墙，本文的端口转发是80端口，需开启Apache或者Nginx等监听80端口的服务。






